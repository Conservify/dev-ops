server {

	listen   80;

	error_page 411 = @my_411_error;
	location @my_411_error {
		# chunkin_resume;
	}

	server_name	fieldkit.org www.fieldkit.org;

	access_log  /var/log/nginx/fieldkit.access.log;
	error_log  /var/log/nginx/fieldkit.error.log debug;

	include server-common.conf;

	location / {
		root /var/www/fieldkit.org;
		try_files $uri @landing;

        	# rewrite ^ https://fieldkit.org$request_uri? permanent;
	}

	location @landing {
		include common.conf;

		proxy_pass         http://fk-landing:80;
		proxy_redirect     off;

		proxy_set_header   Host             $host;
		proxy_set_header   X-Real-IP        $remote_addr;
		proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
		proxy_max_temp_file_size 0;

		client_max_body_size       1g;
		client_body_buffer_size    128k;

		proxy_connect_timeout      90;
		proxy_send_timeout         90;
		proxy_read_timeout         90;

		proxy_buffer_size          4k;
		proxy_buffers              4 32k;
		proxy_busy_buffers_size    64k;
	}
}

server {
	listen   443;
	server_name	fieldkit.org;

	ssl                  on;
	ssl_certificate      /etc/letsencrypt/live/fieldkit.org/fullchain.pem;
	ssl_certificate_key  /etc/letsencrypt/live/fieldkit.org/privkey.pem;

	access_log  /var/log/nginx/fieldkit.access.log;
	error_log  /var/log/nginx/fieldkit.error.log debug;

	include server-common.conf;

	location / {
		root /var/www/fieldkit.org;
		try_files $uri @landing;

        	# rewrite ^ https://fieldkit.org$request_uri? permanent;
	}

	location @landing {
		include common.conf;

		proxy_pass         http://fk-landing:80;
		proxy_redirect     off;

		proxy_set_header   Host             $host;
		proxy_set_header   X-Real-IP        $remote_addr;
		proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
		proxy_max_temp_file_size 0;

		client_max_body_size       1g;
		client_body_buffer_size    128k;

		proxy_connect_timeout      90;
		proxy_send_timeout         90;
		proxy_read_timeout         90;

		proxy_buffer_size          4k;
		proxy_buffers              4 32k;
		proxy_busy_buffers_size    64k;
	}
}


server {
	listen   443;
	server_name	www.fieldkit.org;

	ssl                  on;
	ssl_certificate      /etc/letsencrypt/live/www.fieldkit.org/fullchain.pem;
	ssl_certificate_key  /etc/letsencrypt/live/www.fieldkit.org/privkey.pem;

	access_log  /var/log/nginx/www.fieldkit.access.log;
	error_log  /var/log/nginx/www.fieldkit.error.log debug;

	include server-common.conf;

	location / {
		root /var/www/fieldkit.org;
		try_files $uri @landing;

        	# rewrite ^ https://fieldkit.org$request_uri? permanent;
	}

	location @landing {
		include common.conf;

		proxy_pass         http://fk-landing:80;
		proxy_redirect     off;

		proxy_set_header   Host             $host;
		proxy_set_header   X-Real-IP        $remote_addr;
		proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
		proxy_max_temp_file_size 0;

		client_max_body_size       1g;
		client_body_buffer_size    128k;

		proxy_connect_timeout      90;
		proxy_send_timeout         90;
		proxy_read_timeout         90;

		proxy_buffer_size          4k;
		proxy_buffers              4 32k;
		proxy_busy_buffers_size    64k;
	}
}

